<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />

    <title>Distribuciones</title>

    <!-- Required Stylesheets -->
    <link type="text/css" rel="stylesheet" href="https://unpkg.com/bootstrap/dist/css/bootstrap.min.css"/>
    <link type="text/css" rel="stylesheet" href="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.css"/>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha256-4+XzXVhsDmqanXGHaHvgh1gMQKX40OUvDEBTu8JcmNs=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue-js-toggle-button/1.3.3/ssr.index.min.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es2015%2CIntersectionObserver"></script>
    <script src="https://unpkg.com/vue@latest/dist/vue.js"></script>
    <script src="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.js"></script>

  </head>
  <body>
    
    <div id="app">

      <!-- navBar -->
      <div>
        <b-navbar toggleable="lg" type="dark" variant="info">
          <b-navbar-brand href="#">Calculadora de Distribuciones</b-navbar-brand >
          <b-navbar-toggle target="nav-collapse"></b-navbar-toggle>
          <b-collapse id="nav-collapse" is-nav>
            <b-navbar-nav>
              <b-nav-item @click="setCurrentTab(1)">Distribución normal</b-nav-item>
              <b-nav-item @click="setCurrentTab(2)">Distribución binomial</b-nav-item>
              <b-nav-item @click="setCurrentTab(3)">Distribución de Poisson</b-nav-item>
              <b-nav-item @click="setCurrentTab(4)">Distribución Hipergeométrica</b-nav-item>
            </b-navbar-nav>
          </b-collapse>
        </b-navbar>
      </div>

      <b-container>

        <br><br>

        <!-- Dist. Normal -->
        <div v-show="currentTab==1">

          <b-input-group size="lg" class="mb-4">
            <b-form-input placeholder="Ingresa la cantidad de elementos" v-model="normalCantidad" v-on:keypress="onlyNumbers($event)"></b-form-input>
          </b-input-group>

          <b-button class="text-center col-12 mb-4" variant="danger" @click="distribucionNormal()">Calcular</b-button>
          
          <p class="col-12 mb-4 text-center">{{finalUniforme}}</p>

        </div>

        <!-- Dist. Binomial -->
        <div v-show="currentTab==2">
          <div>
            <b-form-checkbox size="lg" v-model="banderaExito"
              >Éxito</b-form-checkbox
            >
            <b-form-checkbox size="lg" v-model="banderaFracaso"
              >Fracaso</b-form-checkbox
            >
            <label>{{ banderaExito }}</label>
          </div>
          <b-input-group size="lg">
            <b-form-input
              placeholder="Ingresa la probabilidad de éxito"
              v-model="pExito"
            ></b-form-input>
          </b-input-group>
          <b-input-group size="lg">
            <b-form-input
              placeholder="Ingresa la probabilidad de fracaso"
              v-model="qFracaso"
            ></b-form-input>
          </b-input-group>
          <b-input-group size="lg">
            <b-form-input
              placeholder="Ingresa la cantidad de eventos esperados"
              v-model="probabilidadEventos"
            ></b-form-input>
          </b-input-group>
          <b-input-group size="lg">
            <b-form-input
              placeholder="Ingresa la cantidad de ciclos"
              v-model="nCiclos"
            ></b-form-input>
          </b-input-group>
          <div>
            <b-button
              variant="danger"
              @click="distribucionBinomial(pExito,qFracaso,nCiclos,probabilidadEventos)"
              >Ingresar</b-button
            >
          </div>
        </div>

        <!-- Dist. Possion -->
        <div v-show="currentTab==3">
          <p class="mb-4">p({{ xExito}};{{lPromedio}}) </p>
          <b-input-group size="lg" class="mb-4">
            <b-form-input placeholder="Ingresa el número de éxitos" v-model="xExito"></b-form-input>
          </b-input-group>

          <b-input-group size="lg" class="mb-4">
            <b-form-input placeholder="Ingresa el promedio de éxitos esperados" v-model="lPromedio"></b-form-input>
          </b-input-group>
          
          <b-button class="text-center col-12 mb-4" variant="danger" @click="distribucionPossion(normalCantidad)">Ingresar</b-button>

          <div>
            <p class="col-12 mb-4 text-center">La probabilidad de que sea un éxito en base al número de éxitos esperados es:  </p>
            <p class="col-12 mb-4 text-center">p({{ xExito}};{{lPromedio}}) = {{finalPossion}}</p>
            <p class="col-12 mb-4 text-center">La probabilidad de que sea menor a el número de éxitos es:   </p>
            <p class="col-12 mb-4 text-center">p({{ xExito}}<{{lPromedio}}) = {{finalPossionSum}}</p>
          </div>
        </div>

        <!-- Dist. Hipergeometrica -->
        <div v-show="currentTab==4">
          <!-- Using props -->
          <b-input-group size="lg" prepend="$" append=".00">
            <b-form-input></b-form-input>
          </b-input-group>
        </div>
      </b-container>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <!-- Start running your app -->
    <script>
      window.app = new Vue({
        el: "#app",
        data: {
          mainUrl:'http://localhost:3000/distribuciones',
          name: "",
          currentTab: "",
          normalCantidad: "",
          finalUniforme: "",
          resultadoNormalArray: [],
          resultadoPossionArray: [],
          pExito: "",
          qFracaso: "",
          probabilidadEventos: "",
          nCiclos: "",
          finalBinomial: "",
          xExito: "",
          lPromedio: "",
          probabilidad: "",
          finalPossion: "",
          finalPossionSum: "",
          banderaExito: true,
          banderaFracaso: false,
        },
        methods: {
          setCurrentTab(tab) {
            this.currentTab = tab;

            console.log(this.currentTab);
          },
          distribucionNormal() {

            if(this.normalCantidad){

              axios.post(this.mainUrl +"/uniforme",{
                cantidadElementos: this.normalCantidad
              })
              .then(function (response) {

                console.log(response);
              })
              .catch(function (error) {
                console.log(error);
              });

            }
          },
          distribucionBinomial(valX, valY, ciclos, n) {
            let result,
              x,y = 0;

            let diff = ciclos - n;

            for (var i = 1; i <= n; i++) {
              if (i == 1) {
                x = valX;
              } else {
                x = x * valX;
              }
            }

            for (var i = 1; i <= diff; i++) {
              if (i == 1) {
                y = valY;
              } else {
                y = y * valY;
              }
            }

            return x * y;
          },
          switchBinomial(p, q, c, n) {
            // TODO
          },
          distribucionPossion() {       
            PExito = this.xExito;
            PEXitosum = this.xExito-1;
            PPromedio = this.lPromedio;
            totalsum = 0;
             //Esto se agregó para evitar un error en el segundo resultado cuando el primer valor es 0
            Factorcero = this.finalPossion = (Math.exp(-7) * Math.pow(PPromedio, 0)) / this.factorial(1)
            for (var i = 0; i < PEXitosum; i++) {
                this.resultadoPossionArray.push(i + 1);
                console.log(this.resultadoPossionArray[i]);
                Fac = this.resultadoPossionArray[i];
                console.log(this.finalPossionSum = (Math.exp(-7) * Math.pow(PPromedio,Fac)) / this.factorial(Fac));
                sum = this.finalPossionSum = (Math.exp(-7) * Math.pow(PPromedio,Fac)) / this.factorial(Fac);
                totalsum = totalsum+sum;
              }
              this.finalPossionSum = totalsum + Factorcero;
              //Esto se agregó para evitar un error en el primer resultado cuando el primer valor es 0
            if(PExito == 0){
              this.finalPossion = (Math.exp(-7) * Math.pow(PPromedio, PExito)) / this.factorial(1);
            } else {
              this.finalPossion = (Math.exp(-7) * Math.pow(PPromedio, PExito)) / this.factorial(PExito);
            }
            
          
          },
          factorial(num) {
              if (num === 0) {
                return 1;
              } else {
                return num * this.factorial(num - 1);
              }
          },
          onlyNumbers: function(evt) {
            evt = (evt) ? evt : window.event;

            var charCode = (evt.which) ? evt.which : evt.keyCode;

            if ((charCode > 31 && (charCode < 48 || charCode > 57))) {
              evt.preventDefault();;
            } else {
              return true;
            }
          }
        },
        watch: {
          currentTab: function () {
            switch (this.currentTab) {
              case 1:
                console.log("caso1");
                this.normalCantidad = "";
                break;
            }
          },
         /* pUno: function(){
           return this.xExito ;
          },
          pDos: function(){
            this.lPromedio;
          }, */
          pExito: function () {
            this.qFracaso = 100 - this.pExito;
          },
          qFracaso: function () {
            this.pExito = 100 - this.qFracaso;
          },
          banderaExito: function () {
            if (this.banderaExito == true) {
              this.banderaFracaso = false;
            }
          },
          banderaFracaso: function () {
            if (this.banderaFracaso == true) {
              this.banderaExito = false;
            }
          },
        },
      });
    </script>
  </body>
</html>
